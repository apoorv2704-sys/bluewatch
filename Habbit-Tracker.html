 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Habit Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* --- CSS VARIABLES & RESET --- */
        :root {
            --bg: #000000;
            --card: #111111;
            --border: #222222;
            --text: #ffffff;
            --muted: #888888;
            --accent: #00c853;
            --danger: #cf6679;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }

        body {
            background-color: var(--bg);
            color: var(--text);
            height: 100vh;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- LAYOUT --- */
        header {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            background: var(--bg);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .menu-btn {
            background: none;
            border: none;
            color: var(--text);
            font-size: 1.5rem;
            cursor: pointer;
            margin-right: 15px;
        }

        h1 { font-size: 1.2rem; font-weight: 600; }

        /* --- VIEWS --- */
        .view { display: none; padding: 20px; padding-bottom: 80px; }
        .view.active { display: block; animation: fade 0.2s ease; }
        @keyframes fade { from { opacity: 0; } to { opacity: 1; } }

        /* --- COMMON INPUTS --- */
        input[type="text"], input[type="date"], textarea {
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 12px;
            border-radius: 6px;
            width: 100%;
            margin-bottom: 10px;
            font-size: 1rem;
            outline: none;
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }

        input[type="date"] {
            color-scheme: dark;
        }

        /* --- COMPONENT: BUTTONS --- */
        .action-btn {
            background: var(--accent);
            color: black;
            border: none;
            padding: 12px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            font-size: 1rem;
        }
        .action-btn:hover { opacity: 0.9; }

        /* --- COMPONENT: DAY NAVIGATION --- */
        .day-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 5px;
        }

        .nav-arrow {
            background: transparent;
            border: none;
            color: var(--text);
            font-size: 1.2rem;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 4px;
        }
        .nav-arrow:hover { background: #222; }

        .date-display {
            font-size: 0.9rem;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
        }

        /* --- COMPONENT: HABIT LIST --- */
        .habit-card {
            background: var(--card);
            border: 1px solid var(--border);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: border-color 0.2s;
        }
        .habit-card.done { border-color: var(--accent); }
        .habit-card.done .habit-name { color: var(--accent); }

        .checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--muted);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: transparent;
        }
        .habit-card.done .checkbox { background: var(--accent); border-color: var(--accent); color: #000; font-weight: bold; }
        .habit-card.done .checkbox::after { content: '✓'; }

        /* --- COMPONENT: CHARTS & STATS --- */
        .chart-container {
            background: var(--card);
            border: 1px solid var(--border);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            position: relative;
            width: 100%;
            height: 350px; /* Fixed height to prevent moving */
        }

        .stat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: var(--card);
            border: 1px solid var(--border);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-number { font-size: 2rem; color: var(--accent); font-weight: bold; }
        .stat-label { color: var(--muted); font-size: 0.8rem; }

        /* --- COMPONENT: REMINDERS & NOTES --- */
        .card-item {
            background: var(--card);
            border-left: 4px solid var(--accent);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
            position: relative;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .card-title { font-size: 1.1rem; font-weight: 600; color: var(--text); }
        .card-meta { font-size: 0.8rem; color: var(--accent); margin-bottom: 5px; display: block; }
        .card-body { font-size: 0.95rem; color: #ccc; white-space: pre-wrap; line-height: 1.4; }

        .delete-icon {
            color: var(--muted);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0 5px;
        }
        .delete-icon:hover { color: var(--danger); }

        /* --- COMPONENT: PROGRESS BAR --- */
        .progress-bar-bg {
            height: 6px; background: var(--border); border-radius: 3px; margin: 15px 0; overflow: hidden;
        }
        .progress-fill { height: 100%; background: var(--accent); width: 0%; transition: width 0.3s ease; }

        /* --- COMPONENT: CALENDAR --- */
        .calendar-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .cal-btn { background: var(--card); border: 1px solid var(--border); color: var(--text); padding: 5px 15px; border-radius: 4px; cursor: pointer; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
        .day-header { color: var(--muted); font-size: 0.8rem; text-align: center; margin-bottom: 10px; }
        .day {
            aspect-ratio: 1; background: var(--card); border: 1px solid var(--border);
            display: flex; align-items: center; justify-content: center; font-size: 0.9rem;
            cursor: pointer; border-radius: 4px; position: relative;
        }
        .day.has-data::after { content: ''; position: absolute; bottom: 4px; width: 4px; height: 4px; background: var(--accent); border-radius: 50%; }
        .day.selected { border-color: var(--text); background: #222; }
        .day.empty { background: transparent; border: none; cursor: default; }

        /* --- COMPONENT: CUSTOMIZE TASKS --- */
        .task-edit-item { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; }
        .icon-btn {
            background: var(--card); border: 1px solid var(--border); color: var(--muted);
            width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; border-radius: 4px; font-size: 1.1rem;
            min-width: 40px;
        }
        .icon-btn:hover { color: var(--text); }
        .icon-btn.delete:hover { color: var(--danger); border-color: var(--danger); }
        .add-task-container { margin-top: 20px; border-top: 1px solid var(--border); padding-top: 20px; display: flex; gap: 10px; }

        /* --- DRAWER --- */
        .drawer-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 99; display: none; }
        .drawer-overlay.open { display: block; }
        .drawer {
            position: fixed; top: 0; left: 0; width: 250px; height: 100%; background: var(--card);
            border-right: 1px solid var(--border); z-index: 100; transform: translateX(-100%);
            transition: transform 0.3s ease; padding-top: 60px;
        }
        .drawer.open { transform: translateX(0); }
        .nav-item { padding: 15px 20px; color: var(--text); border-bottom: 1px solid var(--border); cursor: pointer; display: block; }
        .nav-item:hover { background: #222; }
    </style>
</head>
<body>

    <div class="drawer-overlay" id="overlay"></div>
    <div class="drawer" id="drawer">
        <div class="nav-item" onclick="navigateTo('home')">Home</div>
        <div class="nav-item" onclick="navigateTo('calendar')">Calendar</div>
        <div class="nav-item" onclick="navigateTo('monthly')">Monthly Report</div>
        <div class="nav-item" onclick="navigateTo('reminders')">Reminders</div>
        <div class="nav-item" onclick="navigateTo('notes')">My Notes</div>
        <div class="nav-item" onclick="navigateTo('stats')">Charts & Progress</div>
        <div class="nav-item" onclick="navigateTo('customize')">Customize Tasks</div>
    </div>

    <header>
        <button class="menu-btn" id="menuBtn">☰</button>
        <h1 id="page-title">Today</h1>
    </header>

    <div id="home" class="view active">
        <div class="day-nav">
            <button class="nav-arrow" onclick="changeDay(-1)">❮</button>
            <span class="date-display" id="currentDateDisplay" onclick="jumpToToday()">DATE</span>
            <button class="nav-arrow" onclick="changeDay(1)">❯</button>
        </div>
        <div id="habit-list"></div>
        <div class="chart-container" style="height: auto; border: none; background: transparent; padding: 0; margin-top: 20px;">
            <p style="margin-bottom: 10px; color: var(--muted); font-size: 0.9rem;">Daily Completion</p>
            <div class="progress-bar-bg"><div class="progress-fill" id="daily-progress-bar"></div></div>
            <p id="daily-progress-text" style="color: var(--muted); font-size: 0.8rem; text-align: right;">0%</p>
        </div>
    </div>

    <div id="calendar" class="view">
        <div class="calendar-nav">
            <button class="cal-btn" onclick="changeCalendarMonth(-1, 'calendar')">⏮</button>
            <h3 id="calendar-month-year">Month</h3>
            <button class="cal-btn" onclick="changeCalendarMonth(1, 'calendar')">⏭</button>
        </div>
        <div class="calendar-grid">
            <div class="day-header">S</div><div class="day-header">M</div><div class="day-header">T</div><div class="day-header">W</div><div class="day-header">T</div><div class="day-header">F</div><div class="day-header">S</div>
        </div>
        <div class="calendar-grid" id="calendar-days"></div>
    </div>

    <div id="monthly" class="view">
        <div class="calendar-nav">
            <button class="cal-btn" onclick="changeCalendarMonth(-1, 'monthly')">⏮</button>
            <h3 id="monthly-report-header">Month</h3>
            <button class="cal-btn" onclick="changeCalendarMonth(1, 'monthly')">⏭</button>
        </div>
        
        <div class="stat-grid">
            <div class="stat-box">
                <div class="stat-number" id="month-perfect">0</div>
                <div class="stat-label">Perfect Days</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="month-active">0</div>
                <div class="stat-label">Consistent Days</div>
            </div>
        </div>

        <div class="stat-box" style="margin-bottom: 20px; border-color: var(--danger);">
            <div class="stat-number" style="color: var(--danger);" id="month-skipped">0</div>
            <div class="stat-label">Days Skipped (0 Activity)</div>
        </div>

        <div class="chart-container">
            <p style="margin-bottom: 10px; color: var(--muted);">Monthly Efficiency</p>
            <canvas id="monthlyPieChart"></canvas>
        </div>
    </div>

    <div id="reminders" class="view">
        <div id="reminder-form" style="margin-bottom: 30px;">
            <h3 style="margin-bottom: 10px; color: var(--muted);">Add Reminder</h3>
            <input type="text" id="reminder-text" placeholder="Title (e.g., Birthday, Event)">
            <input type="date" id="reminder-date">
            <button class="action-btn" onclick="addReminder()">Save Reminder</button>
        </div>
        <h3 style="margin-bottom: 15px; color: var(--text);">Upcoming</h3>
        <div id="reminder-list"></div>
    </div>

    <div id="notes" class="view">
        <div id="note-form" style="margin-bottom: 30px;">
            <h3 style="margin-bottom: 10px; color: var(--muted);">Create Note</h3>
            <input type="text" id="note-title" placeholder="Note Title">
            <textarea id="note-body" placeholder="Write your description here..."></textarea>
            <button class="action-btn" onclick="addNote()">Save Note</button>
        </div>
        <h3 style="margin-bottom: 15px; color: var(--text);">My Notes</h3>
        <div id="notes-list"></div>
    </div>

    <div id="stats" class="view">
        <div class="stat-grid">
            <div class="stat-box">
                <div class="stat-number" id="streak-count">0</div>
                <div class="stat-label">Current Streak</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="total-perfect-days">0</div>
                <div class="stat-label">Total Perfect Days</div>
            </div>
        </div>
        <h3 style="margin-bottom: 15px; font-size: 1rem;">History (Last 14 Days)</h3>
        <div class="chart-container"><canvas id="lineChart"></canvas></div>
    </div>

    <div id="customize" class="view">
        <div id="task-edit-list"></div>
        <div class="add-task-container">
            <input type="text" id="new-task-input" style="margin-bottom: 0;" placeholder="New habit name...">
            <button class="icon-btn" onclick="addNewTask()">＋</button>
        </div>
    </div>

    <script>
        /* --- CONFIGURATION --- */
        const defaultHabits = [
            "Wake up at 5:50", "Workout", "Meditation", "Mandir / Prayer", "Self-help Reading",
            "Accountancy – S1", "Accountancy – S2", "Accountancy – S3", "Accountancy – S4",
            "IPMAT – S1", "IPMAT – S2", "English Speaking", "Typing Practice", "Karate Training",
            "Skill Building", "Social ≤ 90 min", "No Phone During Study", "Planned Next Day", "Slept on Time"
        ];

        /* --- STATE --- */
        let habitConfig = JSON.parse(localStorage.getItem('habitConfig'));
        if (!habitConfig) {
            habitConfig = defaultHabits.map((name, i) => ({ id: `h${i}`, name: name }));
            localStorage.setItem('habitConfig', JSON.stringify(habitConfig));
        }

        let habitData = JSON.parse(localStorage.getItem('habitData')) || {};
        let reminders = JSON.parse(localStorage.getItem('reminders')) || [];
        let notes = JSON.parse(localStorage.getItem('notes')) || [];
        
        let activeDate = new Date(); 
        let calendarViewDate = new Date();
        let monthlyReportDate = new Date(); 
        
        let lineChartInstance = null;
        let monthlyPieInstance = null;

        /* --- INITIALIZATION --- */
        const init = () => renderHome();

        /* --- PERSISTENCE --- */
        const saveData = () => {
            localStorage.setItem('habitConfig', JSON.stringify(habitConfig));
            localStorage.setItem('habitData', JSON.stringify(habitData));
            localStorage.setItem('reminders', JSON.stringify(reminders));
            localStorage.setItem('notes', JSON.stringify(notes));
        };

        /* --- UTILS --- */
        const getKey = (date) => date.toISOString().split('T')[0];
        const formatDate = (date) => date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });

        /* --- NAVIGATION --- */
        const drawer = document.getElementById('drawer');
        const overlay = document.getElementById('overlay');
        const menuBtn = document.getElementById('menuBtn');
        const pageTitle = document.getElementById('page-title');

        const toggleMenu = () => {
            drawer.classList.toggle('open');
            overlay.classList.toggle('open');
        };

        menuBtn.addEventListener('click', toggleMenu);
        overlay.addEventListener('click', toggleMenu);

        const navigateTo = (viewId) => {
            document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            
            if (viewId === 'home') {
                pageTitle.innerText = "Daily Habits";
                renderHome();
            } else if (viewId === 'calendar') {
                pageTitle.innerText = "Calendar";
                calendarViewDate = new Date(activeDate);
                renderCalendar();
            } else if (viewId === 'monthly') {
                pageTitle.innerText = "Monthly Report";
                renderMonthlyReport();
            } else if (viewId === 'reminders') {
                pageTitle.innerText = "Reminders";
                renderReminders();
            } else if (viewId === 'notes') {
                pageTitle.innerText = "My Notes";
                renderNotes();
            } else if (viewId === 'stats') {
                pageTitle.innerText = "Progress";
                renderStats();
            } else if (viewId === 'customize') {
                pageTitle.innerText = "Edit Tasks";
                renderCustomize();
            }
            if(drawer.classList.contains('open')) toggleMenu();
        };

        /* --- VIEW: HOME --- */
        const changeDay = (offset) => {
            activeDate.setDate(activeDate.getDate() + offset);
            renderHome();
        };

        const jumpToToday = () => {
            activeDate = new Date();
            renderHome();
        };

        const renderHome = () => {
            const dateKey = getKey(activeDate);
            const todayKey = getKey(new Date());
            pageTitle.innerText = (dateKey === todayKey) ? "Today" : "History";

            document.getElementById('currentDateDisplay').innerText = formatDate(activeDate);
            const listContainer = document.getElementById('habit-list');
            listContainer.innerHTML = '';

            if (!habitData[dateKey]) habitData[dateKey] = {};

            let completedCount = 0;

            habitConfig.forEach(habit => {
                const isDone = habitData[dateKey][habit.id] === true;
                if(isDone) completedCount++;

                const card = document.createElement('div');
                card.className = `habit-card ${isDone ? 'done' : ''}`;
                card.onclick = (e) => toggleHabit(dateKey, habit.id);
                card.innerHTML = `<span class="habit-name">${habit.name}</span><div class="checkbox"></div>`;
                listContainer.appendChild(card);
            });

            const total = habitConfig.length;
            const percent = total === 0 ? 0 : Math.round((completedCount / total) * 100);
            document.getElementById('daily-progress-bar').style.width = `${percent}%`;
            document.getElementById('daily-progress-text').innerText = `${percent}% Completed`;
        };

        const toggleHabit = (dateKey, habitId) => {
            habitData[dateKey][habitId] = !habitData[dateKey][habitId];
            saveData();
            renderHome();
        };

        /* --- VIEW: CALENDAR & MONTHLY SHARED --- */
        const changeCalendarMonth = (offset, context) => {
            if(context === 'calendar') {
                calendarViewDate.setMonth(calendarViewDate.getMonth() + offset);
                renderCalendar();
            } else {
                monthlyReportDate.setMonth(monthlyReportDate.getMonth() + offset);
                renderMonthlyReport();
            }
        };

        const renderCalendar = () => {
            const container = document.getElementById('calendar-days');
            container.innerHTML = '';
            
            const year = calendarViewDate.getFullYear();
            const month = calendarViewDate.getMonth();
            document.getElementById('calendar-month-year').innerText = calendarViewDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            for (let i = 0; i < firstDay; i++) container.appendChild(Object.assign(document.createElement('div'), {className: 'day empty'}));

            for (let d = 1; d <= daysInMonth; d++) {
                const dayDate = new Date(year, month, d);
                const dayKey = getKey(dayDate);
                const el = document.createElement('div');
                el.className = 'day';
                el.innerText = d;
                if (dayKey === getKey(activeDate)) el.classList.add('selected');
                if (habitData[dayKey] && Object.values(habitData[dayKey]).some(val => val === true)) el.classList.add('has-data');
                el.onclick = () => { activeDate = dayDate; navigateTo('home'); };
                container.appendChild(el);
            }
        };

        /* --- VIEW: MONTHLY REPORT --- */
        const renderMonthlyReport = () => {
            const year = monthlyReportDate.getFullYear();
            const month = monthlyReportDate.getMonth();
            document.getElementById('monthly-report-header').innerText = monthlyReportDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            let perfectDays = 0;
            let activeDays = 0;
            let skippedDays = 0;

            const today = new Date();
            const isCurrentMonth = (today.getFullYear() === year && today.getMonth() === month);
            const checkLimit = isCurrentMonth ? today.getDate() : daysInMonth;

            for(let d = 1; d <= checkLimit; d++) {
                const checkDate = new Date(year, month, d);
                const k = getKey(checkDate);
                const dayData = habitData[k];
                
                if(!dayData) { skippedDays++; continue; }
                const completedCount = Object.values(dayData).filter(v => v).length;
                if(completedCount === 0) skippedDays++;
                else {
                    activeDays++;
                    if(completedCount >= habitConfig.length) perfectDays++;
                }
            }

            document.getElementById('month-perfect').innerText = perfectDays;
            document.getElementById('month-active').innerText = activeDays;
            document.getElementById('month-skipped').innerText = skippedDays;

            if(monthlyPieInstance) monthlyPieInstance.destroy();
            const ctx = document.getElementById('monthlyPieChart').getContext('2d');
            monthlyPieInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Consistent', 'Skipped', 'Perfect'],
                    datasets: [{
                        data: [activeDays - perfectDays, skippedDays, perfectDays],
                        backgroundColor: ['#2e7d32', '#cf6679', '#00c853'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: false, /* <--- STOPS MOVEMENT */
                    plugins: { legend: { position: 'right', labels: { color: '#ccc' } } }
                }
            });
        };

        /* --- VIEW: REMINDERS --- */
        const renderReminders = () => {
            const list = document.getElementById('reminder-list');
            list.innerHTML = '';
            
            reminders.sort((a, b) => new Date(a.date) - new Date(b.date));

            if(reminders.length === 0) {
                list.innerHTML = '<p style="text-align:center; color: var(--muted); padding: 20px;">No upcoming reminders.</p>';
            }

            reminders.forEach(item => {
                const div = document.createElement('div');
                div.className = 'card-item';
                const dateObj = new Date(item.date);
                const dateStr = dateObj.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                
                div.innerHTML = `
                    <div style="flex:1">
                        <span class="card-meta">${dateStr}</span>
                        <div class="card-title">${item.text}</div>
                    </div>
                    <div class="delete-icon" onclick="deleteReminder(${item.id})">✕</div>
                `;
                div.style.display = 'flex';
                div.style.justifyContent = 'space-between';
                div.style.alignItems = 'center';
                
                list.appendChild(div);
            });
        };

        const addReminder = () => {
            const txt = document.getElementById('reminder-text');
            const dateInput = document.getElementById('reminder-date');
            
            if(!txt.value || !dateInput.value) return alert("Please enter both text and date.");

            reminders.push({ id: Date.now(), text: txt.value, date: dateInput.value });
            txt.value = ''; dateInput.value = '';
            saveData(); renderReminders();
        };

        const deleteReminder = (id) => {
            if(confirm("Delete this reminder?")) {
                reminders = reminders.filter(r => r.id !== id);
                saveData(); renderReminders();
            }
        };

        /* --- VIEW: NOTES --- */
        const renderNotes = () => {
            const list = document.getElementById('notes-list');
            list.innerHTML = '';

            const sortedNotes = [...notes].reverse();

            if(sortedNotes.length === 0) {
                list.innerHTML = '<p style="text-align:center; color: var(--muted); padding: 20px;">No notes yet.</p>';
            }

            sortedNotes.forEach(note => {
                const div = document.createElement('div');
                div.className = 'card-item';
                div.innerHTML = `
                    <div class="card-header">
                        <div class="card-title">${note.title}</div>
                        <div class="delete-icon" onclick="deleteNote(${note.id})">✕</div>
                    </div>
                    <div class="card-body">${note.text}</div>
                `;
                list.appendChild(div);
            });
        };

        const addNote = () => {
            const title = document.getElementById('note-title');
            const body = document.getElementById('note-body');

            if(!title.value.trim() && !body.value.trim()) return alert("Please write something.");

            notes.push({
                id: Date.now(),
                title: title.value || "Untitled",
                text: body.value
            });

            title.value = '';
            body.value = '';
            saveData();
            renderNotes();
        };

        const deleteNote = (id) => {
            if(confirm("Delete this note?")) {
                notes = notes.filter(n => n.id !== id);
                saveData();
                renderNotes();
            }
        };

        /* --- VIEW: STATS --- */
        const renderStats = () => {
            let streak = 0; let checkDate = new Date(); let checking = true;
            while(checking) {
                const k = getKey(checkDate);
                const hasActivity = habitData[k] && Object.values(habitData[k]).some(v => v);
                if (hasActivity) { streak++; checkDate.setDate(checkDate.getDate() - 1); }
                else { if (k === getKey(new Date())) checkDate.setDate(checkDate.getDate() - 1); else checking = false; }
                if (streak > 3650) checking = false; 
            }
            document.getElementById('streak-count').innerText = streak;

            let perfect = 0;
            Object.keys(habitData).forEach(k => {
                const doneCount = Object.values(habitData[k]).filter(v => v).length;
                if (doneCount > 0 && doneCount >= habitConfig.length) perfect++;
            });
            document.getElementById('total-perfect-days').innerText = perfect;

            const labels = []; const data = [];
            for(let i=13; i>=0; i--) {
                const d = new Date(); d.setDate(d.getDate() - i);
                labels.push(d.toLocaleDateString('en-US', {day:'numeric', month:'short'}));
                const dayVal = habitData[getKey(d)];
                data.push(dayVal ? Object.values(dayVal).filter(v => v).length : 0);
            }

            if(lineChartInstance) lineChartInstance.destroy();
            const ctx = document.getElementById('lineChart').getContext('2d');
            lineChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Tasks', data: data, borderColor: '#00c853',
                        backgroundColor: 'rgba(0, 200, 83, 0.2)', borderWidth: 2, tension: 0.3, fill: true
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    animation: false, /* <--- STOPS MOVEMENT */
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, grid: { color: '#222' } }, x: { grid: { display: false } } }
                }
            });
        };

        /* --- VIEW: CUSTOMIZE --- */
        const renderCustomize = () => {
            const list = document.getElementById('task-edit-list');
            list.innerHTML = '';
            habitConfig.forEach((habit, index) => {
                const item = document.createElement('div');
                item.className = 'task-edit-item';
                item.innerHTML = `
                    <button class="icon-btn" onclick="moveTask(${index}, -1)">↑</button>
                    <button class="icon-btn" onclick="moveTask(${index}, 1)">↓</button>
                    <input type="text" style="margin-bottom:0" class="task-edit-input" value="${habit.name}" onchange="updateTaskName('${habit.id}', this.value)">
                    <button class="icon-btn delete" onclick="deleteTask('${habit.id}')">✕</button>
                `;
                list.appendChild(item);
            });
        };
        const addNewTask = () => {
            const input = document.getElementById('new-task-input');
            if (!input.value.trim()) return;
            habitConfig.push({ id: 'h_' + Date.now(), name: input.value.trim() });
            input.value = ''; saveData(); renderCustomize();
        };
        const deleteTask = (id) => { if(confirm("Remove task?")) { habitConfig = habitConfig.filter(h => h.id !== id); saveData(); renderCustomize(); }};
        const updateTaskName = (id, newName) => { const h = habitConfig.find(h => h.id === id); if(h) { h.name = newName; saveData(); }};
        const moveTask = (i, dir) => {
            if ((dir === -1 && i === 0) || (dir === 1 && i === habitConfig.length - 1)) return;
            [habitConfig[i], habitConfig[i+dir]] = [habitConfig[i+dir], habitConfig[i]];
            saveData(); renderCustomize();
        };

        /* --- START --- */
        init();

    </script>
</body>
</html>